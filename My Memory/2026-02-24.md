# Session Memory â€” 2026-02-24

## Active Project
- **Repo**: `/home/balaji-12086/Desktop/Workspace/Zide/ai-automation-qa`
- **Framework**: AutomaterSelenium (Java, Ant build, pre-compiled `bin/` at `AutomaterSelenium/bin/`)
- **Runner**: `agents/runner_agent.py` â†’ `run_test.py`
- **Target URL**: `https://sdpodqa-auto1.csez.zohocorpin.com:9090/`
- **Portal**: `portal1`
- **Admin**: `jaya.kumar+org1admin1t0@zohotest.com` / `Zoho@135`
- **Firefox**: `/home/balaji-12086/Desktop/Workspace/Zide/Drivers/firefox/firefox`
- **Geckodriver**: `/home/balaji-12086/Desktop/Workspace/Zide/Drivers/geckodriver`
- **Deps**: `/home/balaji-12086/Desktop/Workspace/Zide/dependencies`
- **venv**: `.venv/`

---

## Tests Status

### âœ… SDPOD_AUTO_SOL_DV_241 â€” `createAndShareApprovedPublicSolutionFromDV`
- **PASSING**
- Creates an approved public solution then shares it from detail view
- Flow: navigate â†’ new solution â†’ fill form â†’ approve â†’ share popup â†’ validate alert
- Key fixes applied previously:
  - Added `SHARE_SOL_POPUP_SUBMIT` locator in `SolutionLocators.SolutionDetailView`
  - Added `SOLUTIONS_SHARED_MSG = "Solutions shared"` in `SolutionConstants.AlertMessages`
  - Fixed `runner_agent.py` `_parse_success()` to use `$$Failure` marker not broad `"Error:"`

### ðŸ”´ SDPOD_AUTO_SOL_DV_242 â€” `createUnapprovedSolutionWithCustomTopicRevDateExpDate`
- **FAILING** â€” current blocker
- **Current error**: `NullPointerException: Cannot invoke JSONObject.optString(String) because response is null`
- The `sdpAPICall` to create the solution template returns null/empty response
- **Root cause being investigated**: `SolutionAPIUtil.createSolutionTemplateAndGetName()` POST to `solution_templates` returns null response from browser JS execution

---

## Architecture Notes

### `RestAPI.java`
- **CRITICAL**: REST API calls go through the **browser** via JavaScript execution (`sdpAPICall(apiPath, method, ...)`)
- NOT a direct HTTP client â€” requires an active logged-in browser session
- `triggerRestAPI()` â†’ `executeScript("sdpAPICall(...).responseJSON")` â†’ browser executes the JS â†’ returns JSON string
- Base URL is implicit (same as browser session origin)

### `SolutionAPIUtil.java`
- `createSolutionTemplateAndGetName(apiPath, inputData)`:
  - POSTs `{ "solution_template": inputData }` to `solution_templates`
  - Stores name in `LocalStorage("solution_template_name")`
  - Returns `response.optJSONObject("solution_template").optString("name")`
- `createSolutionTopicAndGetName(apiPath, inputData)`:
  - POSTs `{ "topic": inputData }` to `topics`
  - Returns `response.optJSONObject("topic").optString("name")`

### Placeholder Resolution
- `$(custom_solution_template)` â†’ `PlaceholderUtil.getValueForCustomPlaceholder("custom_solution_template")` â†’ strips `"custom_"` â†’ `LocalStorage.getAsString("solution_template")`
- `$(custom_topic)` â†’ strips `"custom_"` â†’ `LocalStorage.getAsString("topic")`
- So `LocalStorage.store("solution_template", name)` + `LocalStorage.store("topic", name)` are the correct keys

### `preProcess` flow (Entity.java)
1. `initializeAdminSession()` â†’ browser login as admin
2. `preProcess(group, dataIds)` â†’ when `group = ""` â†’ no-op (returns true immediately)
3. `switchToUserSession()` â†’ browser switches to scenario user
4. `process(method)` â†’ actual test method runs

### `preProcess` silent catch
- `Solution.java::preProcess()` has `catch(Exception) { return false; }` â€” silently hides exceptions
- That's why we moved API calls into the method body â€” exceptions now surface via `addFailureReport`

---

## Key File Locations

| File | Path |
|------|------|
| `Solution.java` | `AutomaterSelenium/src/com/zoho/automater/selenium/modules/solutions/solution/Solution.java` |
| `SolutionBase.java` | `AutomaterSelenium/src/com/zoho/automater/selenium/modules/solutions/solution/SolutionBase.java` |
| `SolutionLocators.java` | `AutomaterSelenium/src/com/zoho/automater/selenium/modules/solutions/solution/SolutionLocators.java` |
| `SolutionConstants.java` | `AutomaterSelenium/src/com/zoho/automater/selenium/modules/solutions/solution/SolutionConstants.java` |
| `SolutionAPIUtil.java` | `AutomaterSelenium/src/com/zoho/automater/selenium/modules/solutions/solution/utils/SolutionAPIUtil.java` |
| `SolutionAnnotationConstants.java` | `AutomaterSelenium/src/com/zoho/automater/selenium/modules/solutions/solution/common/SolutionAnnotationConstants.java` |
| `SolutionDataConstants.java` | `AutomaterSelenium/src/com/zoho/automater/selenium/modules/solutions/solution/common/SolutionDataConstants.java` |
| `solution_data.json` | `AutomaterSelenium/resources/entity/data/solutions/solution/solution_data.json` |
| `Entity.java` | `AutomaterSeleniumFramework/src/com/zoho/automater/selenium/base/Entity.java` |
| `RestAPI.java` | `AutomaterSeleniumFramework/src/com/zoho/automater/selenium/base/client/api/RestAPI.java` |
| `PlaceholderUtil.java` | `AutomaterSeleniumFramework/src/com/zoho/automater/selenium/base/utils/PlaceholderUtil.java` |
| `LocalStorage.java` | `AutomaterSeleniumFramework/src/com/zoho/automater/selenium/base/common/LocalStorage.java` |
| `runner_agent.py` | `agents/runner_agent.py` |
| `run_test.py` | `run_test.py` |

---

## Current State of Modified Files

### `Solution.java` â€” SDPOD_AUTO_SOL_DV_242 annotation (lines ~3887â€“3901)
```java
@Override
@AutomaterScenario(
    group = "",
    priority = Priority.HIGH,
    dataIds = {},
    tags = {},
    owner = OwnerConstants.RAJESHWARAN_A,
    runType = ScenarioRunType.USER_BASED,
    description = "Create an unapproved solution with custom topic, review date and expiry date | AI Generated",
    id = "SDPOD_AUTO_SOL_DV_242"
)
public void createUnapprovedSolutionWithCustomTopicRevDateExpDate() {
    super.createUnapprovedSolutionWithCustomTopicRevDateExpDate();
}
```

### `SolutionBase.java` â€” `createUnapprovedSolutionWithCustomTopicRevDateExpDate()` (line ~7361)
```java
public void createUnapprovedSolutionWithCustomTopicRevDateExpDate() {
    report.startMethodFlowInStepsToReproduce(AutomaterVariables.SCENARIO_START.apply(getMethodName()));
    try {
        JSONObject templateData = getTestCaseDataUsingCaseId(SolutionAnnotationConstants.Data.CUST_SOL_TEMPLATE);
        String templateName = SolutionAPIUtil.createSolutionTemplateAndGetName("solution_templates", templateData);
        LocalStorage.store("solution_template", templateName);

        JSONObject topicData = getTestCaseDataUsingCaseId(SolutionAnnotationConstants.Data.SOL_NEW_TOPIC);
        String topicName = SolutionAPIUtil.createSolutionTopicAndGetName("topics", topicData);
        LocalStorage.store("topic", topicName);

        JSONObject inputData = getTestCaseData(SolutionDataConstants.SolutionData.SOL_UNAPPROVED_PUB_CUST_TEMP_EXP_REV_DATE_CUST_TOPIC);
        actions.navigate.toModule(getModuleName());
        actions.setTableView(SolutionConstants.LISTVIEW);
        actions.navigate.toGlobalActionInListview(SolutionConstants.ListviewGlobalActions.NEW_SOLUTION);
        actions.formBuilder.fillInputForAnEntity(isClientFramework(), fields, inputData);
        actions.click(SolutionLocators.SolutionCreateForm.SOLUTION_IS_PUBLIC_1);
        actions.formBuilder.fillDateField(SolutionConstants.REVIEW_DATE, PlaceholderUtil.getDateInMilliSeconds(2, 2, 1, true));
        actions.formBuilder.fillDateField(SolutionConstants.EXPIRY_DATE, PlaceholderUtil.getDateInMilliSeconds(10, 2, 1, true));
        actions.click(SolutionLocators.SolutionCreateForm.SOLUTION_ADD);
        String text = AutomaterUtil.getValueAsStringFromInputUsingAPIPath(inputData, SolutionFields.TITLE.getDataPath());
        Boolean isEqual = actions.validate.textContent(ClientFrameworkLocators.DetailsViewLocators.MODULE_TITLE, text);
        if (isEqual) {
            addSuccessReport("Unapproved solution with custom topic, review date and expiry date created successfully");
        } else {
            addFailureReport("Unapproved solution creation failed", "Solution title in detail view does not match the input");
        }
    } catch (Exception exception) {
        addFailureReport("Internal error occurred while running the test case " + getModuleName(), exception.toString());
    } finally {
        report.endMethodFlowInStepsToReproduce();
    }
}
```

---

## Current Blocker: `sdpAPICall` returning null for `solution_templates` POST

### Symptom
```
NullPointerException: Cannot invoke JSONObject.optString(String) because response is null
```
At `SolutionAPIUtil.createSolutionTemplateAndGetName` â€” `triggerRestAPIUsingInputData(POST, "solution_templates", data)` returns null.

### Why `sdpAPICall` can return null
- `RestAPI.triggerRestAPI()` calls `executeScript("sdpAPICall(...).responseJSON")`
- If the JS returns `undefined`/`null`, the responseString is null â†’ `response` is null
- This happens if: (a) the page context isn't the right one for sdpAPICall, or (b) the API path is wrong, or (c) the admin session doesn't have access to `solution_templates`

### What to investigate next
1. Check what `sdpAPICall` looks like on the server â€” does it need a full path like `app/portal1/api/v3/solution_templates` or relative `solution_templates`?
2. Check how other existing tests that use `CREATE_CUST_TEMP_TOPIC` group work â€” they go through `preProcess` which runs the same `SolutionAPIUtil.createSolutionTemplateAndGetName` call â€” do those tests pass?
3. Look at similar passing tests: `SDPOD_AUTO_SOL_CREATE_053`â€“`056` use `CREATE_CUST_TEMP_TOPIC` â€” try running one of them to confirm if the API call works in `preProcess` context
4. The key difference: in `preProcess`, the browser is in admin session at the portal homepage; in the method body (with `group=""`), the browser has switched to the **user session** before the method runs â€” `sdpAPICall` may require admin session context

### Likely root cause
With `group = ""`, `preProcess` returns `true` immediately, then `switchToUserSession()` runs, switching the browser to the scenario user's session. Then `createUnapprovedSolutionWithCustomTopicRevDateExpDate()` runs â€” but at this point the browser is in the **user's session**, not admin. `sdpAPICall("solution_templates", "post", ...)` may fail with the user's permissions (users can't create solution templates).

### Fix strategy
- Option A: Keep `group = CREATE_CUST_TEMP_TOPIC` in the annotation so the API calls run in `preProcess` (admin session, before user switch), and debug why preProcess silently fails
- Option B: Add `switchToAdminSession()` before the API calls in the method body, then `switchToUserSession()` after
- **Best**: Go back to using `preProcess` (Option A) â€” add exception logging to understand what's actually failing in the preProcess API call

---

## `run_test.py` current config
```python
RUN_CONFIG = {
    "entity_class":  "Solution",
    "method_name":   "createUnapprovedSolutionWithCustomTopicRevDateExpDate",
    "url":           "https://sdpodqa-auto1.csez.zohocorpin.com:9090/",
    "admin_mail_id": "jaya.kumar+org1admin1t0@zohotest.com",
    "email_id":      "jaya.kumar+org1admin1t0@zohotest.com",
    "portal_name":   "portal1",
    "skip_compile":  True,
}
```

---

## `runner_agent.py` â€” `_parse_success()` logic
- **Fail #1**: `"$$Failure"` in output â†’ FAILED (highest priority)
- **Pass #1**: `'"Additional Specific Info":["'` + `"successfully"` â†’ PASSED
- **Fail #2**: `"BUILD FAILED"` â†’ FAILED
- **Pass #2**: `"BUILD SUCCESSFUL"` â†’ PASSED
- **Fail #3**: Java exceptions: `addFailureReport`, `Exception in thread`, `NullPointerException`, `NoSuchElementException`, `TimeoutException`, `WebDriverException`, `AssertionException`

---

## Data Constants
- `SolutionAnnotationConstants.Data.CUST_SOL_TEMPLATE` = `"cust_sol_template"`
- `SolutionAnnotationConstants.Data.SOL_NEW_TOPIC` = `"sol_new_topic"`
- `SolutionAnnotationConstants.Group.CREATE_CUST_TEMP_TOPIC` = `"create_cust_temp_topic"`
- `SolutionDataConstants.SolutionData.SOL_UNAPPROVED_PUB_CUST_TEMP_EXP_REV_DATE_CUST_TOPIC` â†’ JSON key: `"sol_unapproved_pub_cust_temp_exp_rev_date_cust_topic"`

## JSON data
- `cust_sol_template`: complex layout structure (solution template creation)
- `sol_new_topic`: `{ "name": "topic_$(unique_string)", "icon_key": "solution_Hiring" }`
- `sol_unapproved_pub_cust_temp_exp_rev_date_cust_topic`: uses `$(custom_solution_template)` + `$(custom_topic)`
